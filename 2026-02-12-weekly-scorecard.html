<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weekly Business Scorecard</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0a0a0f; color: #e0e0e0; min-height: 100vh; padding: 20px; }
  .header { text-align: center; margin-bottom: 30px; }
  .header h1 { font-size: 1.8rem; color: #fff; margin-bottom: 4px; }
  .header .subtitle { color: #888; font-size: 0.9rem; }
  .week-nav { display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 24px; }
  .week-nav button { background: #1a1a2e; border: 1px solid #333; color: #ccc; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
  .week-nav button:hover { background: #252540; }
  .week-nav .week-label { font-size: 1rem; color: #fff; font-weight: 600; }
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; max-width: 900px; margin: 0 auto; }
  .card { background: #12121c; border: 1px solid #1e1e30; border-radius: 12px; padding: 20px; }
  .card.full { grid-column: 1 / -1; }
  .card h2 { font-size: 1rem; margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
  .card h2 .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
  .rover .dot { background: #4ade80; }
  .lunouri .dot { background: #a78bfa; }
  .snap .dot { background: #facc15; }
  .overall .dot { background: #38bdf8; }
  .metric { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #1a1a2a; }
  .metric:last-child { border-bottom: none; }
  .metric label { font-size: 0.85rem; color: #aaa; }
  .metric input { background: #0a0a14; border: 1px solid #2a2a3a; color: #fff; padding: 6px 10px; border-radius: 6px; width: 120px; text-align: right; font-size: 0.9rem; }
  .metric input:focus { outline: none; border-color: #4ade80; }
  .metric .computed { font-size: 1rem; font-weight: 600; color: #fff; min-width: 120px; text-align: right; }
  .score-ring { text-align: center; padding: 20px 0; }
  .score-ring .big-number { font-size: 3.5rem; font-weight: 700; }
  .score-ring .label { color: #888; font-size: 0.8rem; margin-top: 4px; }
  .bar-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .bar-row .bar-label { font-size: 0.8rem; color: #aaa; width: 70px; text-align: right; }
  .bar-track { flex: 1; height: 8px; background: #1a1a2a; border-radius: 4px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
  .bar-row .bar-val { font-size: 0.8rem; color: #ccc; width: 40px; }
  .actions { margin-top: 16px; display: flex; gap: 10px; justify-content: center; }
  .actions button { padding: 8px 20px; border-radius: 8px; border: none; cursor: pointer; font-size: 0.85rem; font-weight: 600; }
  .btn-save { background: #4ade80; color: #000; }
  .btn-save:hover { background: #22c55e; }
  .btn-export { background: #1a1a2e; color: #ccc; border: 1px solid #333; }
  .notes-area { width: 100%; background: #0a0a14; border: 1px solid #2a2a3a; color: #ddd; border-radius: 8px; padding: 10px; font-size: 0.85rem; min-height: 80px; resize: vertical; margin-top: 8px; font-family: inherit; }
  .notes-area:focus { outline: none; border-color: #38bdf8; }
  .trend { font-size: 0.7rem; margin-left: 6px; }
  .trend.up { color: #4ade80; }
  .trend.down { color: #f87171; }
  .trend.flat { color: #888; }
  @media (max-width: 640px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div class="header">
  <h1>üìä Weekly Business Scorecard</h1>
  <div class="subtitle">Track all 3 businesses in one place</div>
</div>

<div class="week-nav">
  <button onclick="changeWeek(-1)">‚Üê Prev</button>
  <span class="week-label" id="weekLabel"></span>
  <button onclick="changeWeek(1)">Next ‚Üí</button>
</div>

<div class="grid">
  <!-- Rover -->
  <div class="card rover">
    <h2><span class="dot"></span> Rover Cleaners</h2>
    <div class="metric"><label>Revenue</label><input type="text" data-key="rover_revenue" placeholder="$0" oninput="onInput(this)"></div>
    <div class="metric"><label>Jobs Completed</label><input type="number" data-key="rover_jobs" placeholder="0" oninput="onInput(this)"></div>
    <div class="metric"><label>New Leads</label><input type="number" data-key="rover_leads" placeholder="0" oninput="onInput(this)"></div>
    <div class="metric"><label>Leads Booked</label><input type="number" data-key="rover_booked" placeholder="0" oninput="onInput(this)"></div>
    <div class="metric"><label>Conversion %</label><span class="computed" id="rover_conv">‚Äî</span></div>
    <div class="metric"><label>Contractor Pay</label><input type="text" data-key="rover_pay" placeholder="$0" oninput="onInput(this)"></div>
    <div class="metric"><label>Gross Margin</label><span class="computed" id="rover_margin">‚Äî</span></div>
  </div>

  <!-- Lunouri -->
  <div class="card lunouri">
    <h2><span class="dot"></span> Lunouri</h2>
    <div class="metric"><label>Revenue</label><input type="text" data-key="lunouri_revenue" placeholder="$0" oninput="onInput(this)"></div>
    <div class="metric"><label>Orders</label><input type="number" data-key="lunouri_orders" placeholder="0" oninput="onInput(this)"></div>
    <div class="metric"><label>Ad Spend</label><input type="text" data-key="lunouri_adspend" placeholder="$0" oninput="onInput(this)"></div>
    <div class="metric"><label>ROAS</label><span class="computed" id="lunouri_roas">‚Äî</span></div>
    <div class="metric"><label>COGS</label><input type="text" data-key="lunouri_cogs" placeholder="$0" oninput="onInput(this)"></div>
    <div class="metric"><label>Net Margin</label><span class="computed" id="lunouri_margin">‚Äî</span></div>
  </div>

  <!-- Snap -->
  <div class="card snap">
    <h2><span class="dot"></span> Snapchat W2</h2>
    <div class="metric"><label>Deals Closed</label><input type="number" data-key="snap_deals" placeholder="0" oninput="onInput(this)"></div>
    <div class="metric"><label>Pipeline Value</label><input type="text" data-key="snap_pipeline" placeholder="$0" oninput="onInput(this)"></div>
    <div class="metric"><label>Meetings Held</label><input type="number" data-key="snap_meetings" placeholder="0" oninput="onInput(this)"></div>
    <div class="metric"><label>Hours Worked</label><input type="number" data-key="snap_hours" placeholder="0" oninput="onInput(this)"></div>
    <div class="metric"><label>Effective $/hr</label><span class="computed" id="snap_rate">‚Äî</span></div>
  </div>

  <!-- Overall Score -->
  <div class="card overall">
    <h2><span class="dot"></span> Weekly Score</h2>
    <div class="score-ring">
      <div class="big-number" id="overallScore">‚Äî</div>
      <div class="label">out of 100</div>
    </div>
    <div id="scoreBars"></div>
  </div>

  <!-- Combined Financials -->
  <div class="card full overall">
    <h2><span class="dot"></span> Quit-W2 Progress</h2>
    <div class="metric"><label>Non-W2 Weekly Revenue</label><span class="computed" id="nonw2_rev">‚Äî</span></div>
    <div class="metric"><label>Annualized Non-W2</label><span class="computed" id="nonw2_annual">‚Äî</span></div>
    <div class="metric"><label>Target: $500K/yr</label><span class="computed" id="nonw2_pct">‚Äî</span></div>
    <div style="margin-top: 12px;">
      <div class="bar-row">
        <span class="bar-label">Progress</span>
        <div class="bar-track"><div class="bar-fill" id="goalBar" style="width:0%; background: linear-gradient(90deg, #4ade80, #38bdf8);"></div></div>
        <span class="bar-val" id="goalPct">0%</span>
      </div>
    </div>
  </div>

  <!-- Notes -->
  <div class="card full">
    <h2>üìù Weekly Notes & Wins</h2>
    <textarea class="notes-area" data-key="notes" placeholder="What went well? What to improve? Key decisions made..." oninput="onInput(this)"></textarea>
  </div>
</div>

<div class="actions">
  <button class="btn-save" onclick="saveWeek()">üíæ Save Week</button>
  <button class="btn-export" onclick="exportAll()">üìã Export All Weeks</button>
</div>

<script>
const STORAGE_KEY = 'weekly-scorecard';
let currentWeekOffset = 0;

function getWeekStart(offset = 0) {
  const now = new Date();
  const day = now.getDay();
  const diff = now.getDate() - day + (day === 0 ? -6 : 1) + (offset * 7);
  const d = new Date(now.setDate(diff));
  d.setHours(0,0,0,0);
  return d;
}

function weekKey(offset) {
  const d = getWeekStart(offset);
  return d.toISOString().split('T')[0];
}

function formatWeekLabel(offset) {
  const start = getWeekStart(offset);
  const end = new Date(start); end.setDate(end.getDate() + 6);
  const fmt = d => d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  return `${fmt(start)} ‚Äì ${fmt(end)}, ${end.getFullYear()}`;
}

function getAllData() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); } catch { return {}; }
}

function getWeekData(offset) {
  return getAllData()[weekKey(offset)] || {};
}

function parseMoney(v) {
  if (!v) return 0;
  return parseFloat(String(v).replace(/[^0-9.\-]/g, '')) || 0;
}

function fmt$(n) { return '$' + n.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }); }
function fmtPct(n) { return isFinite(n) ? n.toFixed(1) + '%' : '‚Äî'; }

function loadWeek() {
  document.getElementById('weekLabel').textContent = formatWeekLabel(currentWeekOffset);
  const data = getWeekData(currentWeekOffset);
  document.querySelectorAll('[data-key]').forEach(el => {
    if (el.tagName === 'TEXTAREA') el.value = data[el.dataset.key] || '';
    else el.value = data[el.dataset.key] || '';
  });
  recalc();
}

function onInput(el) { recalc(); }

function getVal(key) {
  const el = document.querySelector(`[data-key="${key}"]`);
  return el ? el.value : '';
}

function recalc() {
  const rv = parseMoney(getVal('rover_revenue'));
  const rp = parseMoney(getVal('rover_pay'));
  const rl = parseFloat(getVal('rover_leads')) || 0;
  const rb = parseFloat(getVal('rover_booked')) || 0;
  document.getElementById('rover_conv').textContent = rl > 0 ? fmtPct(rb/rl*100) : '‚Äî';
  document.getElementById('rover_margin').textContent = rv > 0 ? fmtPct((rv-rp)/rv*100) : '‚Äî';

  const lv = parseMoney(getVal('lunouri_revenue'));
  const la = parseMoney(getVal('lunouri_adspend'));
  const lc = parseMoney(getVal('lunouri_cogs'));
  document.getElementById('lunouri_roas').textContent = la > 0 ? (lv/la).toFixed(2) + 'x' : '‚Äî';
  document.getElementById('lunouri_margin').textContent = lv > 0 ? fmtPct((lv-lc-la)/lv*100) : '‚Äî';

  const sh = parseFloat(getVal('snap_hours')) || 0;
  document.getElementById('snap_rate').textContent = sh > 0 ? fmt$(200000/52/sh) + '/hr' : '‚Äî';

  // Non-W2
  const nonW2 = rv + lv;
  const annual = nonW2 * 52;
  document.getElementById('nonw2_rev').textContent = fmt$(nonW2);
  document.getElementById('nonw2_annual').textContent = fmt$(annual);
  const pct = Math.min(annual / 500000 * 100, 100);
  document.getElementById('nonw2_pct').textContent = fmtPct(annual / 500000 * 100);
  document.getElementById('goalBar').style.width = pct + '%';
  document.getElementById('goalPct').textContent = Math.round(pct) + '%';

  // Score (simple weighted)
  let score = 0;
  // Rover: 50 pts ‚Äî revenue toward $25K/wk ($100K/mo) = 30pts, margin toward 45% = 10pts, conv toward 20% = 10pts
  score += Math.min(rv / 25000, 1) * 30;
  const rm = rv > 0 ? (rv-rp)/rv*100 : 0;
  score += Math.min(rm / 45, 1) * 10;
  const rc = rl > 0 ? rb/rl*100 : 0;
  score += Math.min(rc / 20, 1) * 10;
  // Lunouri: 20 pts ‚Äî revenue = 10, ROAS toward 2x = 10
  score += Math.min(lv / 5000, 1) * 10;
  const roas = la > 0 ? lv/la : 0;
  score += Math.min(roas / 2, 1) * 10;
  // Snap: 15 pts ‚Äî meetings toward 10/wk = 8, deals toward 2/wk = 7
  const sm = parseFloat(getVal('snap_meetings')) || 0;
  const sd = parseFloat(getVal('snap_deals')) || 0;
  score += Math.min(sm / 10, 1) * 8;
  score += Math.min(sd / 2, 1) * 7;
  // Notes: 5 pts for writing something
  score += getVal('notes').trim().length > 20 ? 5 : 0;

  const s = Math.round(score);
  const el = document.getElementById('overallScore');
  el.textContent = s;
  el.style.color = s >= 80 ? '#4ade80' : s >= 50 ? '#facc15' : '#f87171';

  // Score bars
  const bars = [
    { label: 'Rover', val: Math.min(((rv/25000)*30 + (rm/45)*10 + (rc/20)*10)/50*100, 100), color: '#4ade80' },
    { label: 'Lunouri', val: Math.min(((lv/5000)*10 + (roas/2)*10)/20*100, 100), color: '#a78bfa' },
    { label: 'Snap', val: Math.min(((sm/10)*8 + (sd/2)*7)/15*100, 100), color: '#facc15' },
  ];
  document.getElementById('scoreBars').innerHTML = bars.map(b => `
    <div class="bar-row">
      <span class="bar-label">${b.label}</span>
      <div class="bar-track"><div class="bar-fill" style="width:${b.val}%; background:${b.color};"></div></div>
      <span class="bar-val">${Math.round(b.val)}%</span>
    </div>
  `).join('');
}

function saveWeek() {
  const all = getAllData();
  const data = {};
  document.querySelectorAll('[data-key]').forEach(el => {
    data[el.dataset.key] = el.tagName === 'TEXTAREA' ? el.value : el.value;
  });
  all[weekKey(currentWeekOffset)] = data;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
  const btn = document.querySelector('.btn-save');
  btn.textContent = '‚úÖ Saved!';
  setTimeout(() => btn.textContent = 'üíæ Save Week', 1500);
}

function exportAll() {
  const all = getAllData();
  const weeks = Object.keys(all).sort().reverse();
  let csv = 'Week,Rover Rev,Rover Jobs,Rover Leads,Rover Booked,Rover Pay,Lunouri Rev,Lunouri Orders,Lunouri Ad Spend,Lunouri COGS,Snap Deals,Snap Pipeline,Snap Meetings,Snap Hours\n';
  weeks.forEach(w => {
    const d = all[w];
    csv += [w, d.rover_revenue||'', d.rover_jobs||'', d.rover_leads||'', d.rover_booked||'', d.rover_pay||'',
      d.lunouri_revenue||'', d.lunouri_orders||'', d.lunouri_adspend||'', d.lunouri_cogs||'',
      d.snap_deals||'', d.snap_pipeline||'', d.snap_meetings||'', d.snap_hours||''].join(',') + '\n';
  });
  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'weekly-scorecards.csv'; a.click();
}

function changeWeek(dir) { currentWeekOffset += dir; loadWeek(); }

loadWeek();
</script>
</body>
</html>
